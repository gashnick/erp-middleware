{"numFailedTestSuites":2,"numFailedTests":2,"numPassedTestSuites":11,"numPassedTests":132,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":13,"numTotalTests":134,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1770044188996,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["TenantContext","getTenantContext()"],"duration":12,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getTenantContext() should throw error when context is missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192783,"status":"passed","title":"should throw error when context is missing"},{"ancestorTitles":["TenantContext","getTenantContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getTenantContext() should return context when set","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044192796,"status":"passed","title":"should return context when set"},{"ancestorTitles":["TenantContext","getTenantContext()"],"duration":0,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getTenantContext() should not allow SYSTEM fallback","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044192798,"status":"passed","title":"should not allow SYSTEM fallback"},{"ancestorTitles":["TenantContext","getTenantId()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getTenantId() should return tenantId from context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192799,"status":"passed","title":"should return tenantId from context"},{"ancestorTitles":["TenantContext","getTenantId()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getTenantId() should throw if context missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192800,"status":"passed","title":"should throw if context missing"},{"ancestorTitles":["TenantContext","getSchemaName()"],"duration":0,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getSchemaName() should return schemaName from context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192802,"status":"passed","title":"should return schemaName from context"},{"ancestorTitles":["TenantContext","getSchemaName()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getSchemaName() should throw if context missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192803,"status":"passed","title":"should throw if context missing"},{"ancestorTitles":["TenantContext","getUserId()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getUserId() should return userId from context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192806,"status":"passed","title":"should return userId from context"},{"ancestorTitles":["TenantContext","getUserId()"],"duration":0,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getUserId() should throw if context missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192808,"status":"passed","title":"should throw if context missing"},{"ancestorTitles":["TenantContext","getRequestId()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getRequestId() should return requestId from context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192809,"status":"passed","title":"should return requestId from context"},{"ancestorTitles":["TenantContext","getRequestId()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext getRequestId() should throw if context missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192810,"status":"passed","title":"should throw if context missing"},{"ancestorTitles":["TenantContext","hasTenantContext()"],"duration":19,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext hasTenantContext() should return true when context is set","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192812,"status":"passed","title":"should return true when context is set"},{"ancestorTitles":["TenantContext","hasTenantContext()"],"duration":0,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext hasTenantContext() should return false when context is missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192832,"status":"passed","title":"should return false when context is missing"},{"ancestorTitles":["TenantContext","setTenantContextForJob()"],"duration":4,"failing":false,"failureDetails":[{"matcherResult":{"actual":{"tenantId":"tenant-123","userId":"job-runner","requestId":"job-req-789","schemaName":"tenant_abc","userEmail":"job@system.com","userRole":"SYSTEM_JOB","timestamp":{}},"message":"\u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mundefined\u001b[39m\nReceived: \u001b[31m{\"requestId\": \"job-req-789\", \"schemaName\": \"tenant_abc\", \"tenantId\": \"tenant-123\", \"timestamp\": 2026-02-02T14:56:32.833Z, \"userEmail\": \"job@system.com\", \"userId\": \"job-runner\", \"userRole\": \"SYSTEM_JOB\"}\u001b[39m","name":"toBe","pass":false}}],"failureMessages":["Error: \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\nExpected: \u001b[32mundefined\u001b[39m\nReceived: \u001b[31m{\"requestId\": \"job-req-789\", \"schemaName\": \"tenant_abc\", \"tenantId\": \"tenant-123\", \"timestamp\": 2026-02-02T14:56:32.833Z, \"userEmail\": \"job@system.com\", \"userId\": \"job-runner\", \"userRole\": \"SYSTEM_JOB\"}\u001b[39m\n    at Object.<anonymous> (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\common\\context\\tenant-context.spec.ts:189:40)\n    at Promise.finally.completed (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1557:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1497:10)\n    at _callCircusTest (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1007:40)\n    at _runTest (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:947:3)\n    at C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:849:7\n    at _runTestsForDescribeBlock (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:862:11)\n    at _runTestsForDescribeBlock (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at _runTestsForDescribeBlock (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at run (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:761:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1918:21)\n    at jestAdapter (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-circus\\build\\runner.js:101:19)\n    at runTestInternal (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-runner\\build\\index.js:275:16)\n    at runTest (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\jest-runner\\build\\index.js:343:7)"],"fullName":"TenantContext setTenantContextForJob() should set context for background jobs","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"startAt":1770044192833,"status":"failed","title":"should set context for background jobs"},{"ancestorTitles":["TenantContext","setTenantContextForJob()"],"duration":0,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext setTenantContextForJob() should restore previous context after cleanup","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"startAt":1770044192839,"status":"passed","title":"should restore previous context after cleanup"},{"ancestorTitles":["TenantContext","setTenantContextForJob()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext setTenantContextForJob() should generate schemaName if not provided","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192840,"status":"passed","title":"should generate schemaName if not provided"},{"ancestorTitles":["TenantContext","setTenantContextForJob()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext setTenantContextForJob() should use default email and role if not provided","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044192842,"status":"passed","title":"should use default email and role if not provided"},{"ancestorTitles":["TenantContext","runWithTenantContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext runWithTenantContext() should run callback with tenant context","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044192844,"status":"passed","title":"should run callback with tenant context"},{"ancestorTitles":["TenantContext","runWithTenantContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext runWithTenantContext() should restore context after async callback","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044192845,"status":"passed","title":"should restore context after async callback"},{"ancestorTitles":["TenantContext","runWithTenantContext()"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext runWithTenantContext() should propagate errors from callback","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192846,"status":"passed","title":"should propagate errors from callback"},{"ancestorTitles":["TenantContext","runWithTenantContext()"],"duration":0,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext runWithTenantContext() should require tenantId","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192849,"status":"passed","title":"should require tenantId"},{"ancestorTitles":["TenantContext","runWithTenantContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext runWithTenantContext() should require userId","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192850,"status":"passed","title":"should require userId"},{"ancestorTitles":["TenantContext","Context isolation between concurrent calls"],"duration":13,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContext Context isolation between concurrent calls should maintain isolated contexts in parallel async operations","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044192851,"status":"passed","title":"should maintain isolated contexts in parallel async operations"}],"endTime":1770044192910,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mTenantContext › setTenantContextForJob() › should set context for background jobs\u001b[39m\u001b[22m\n\n    \u001b[2mexpect(\u001b[22m\u001b[31mreceived\u001b[39m\u001b[2m).\u001b[22mtoBe\u001b[2m(\u001b[22m\u001b[32mexpected\u001b[39m\u001b[2m) // Object.is equality\u001b[22m\n\n    Expected: \u001b[32mundefined\u001b[39m\n    Received: \u001b[31m{\"requestId\": \"job-req-789\", \"schemaName\": \"tenant_abc\", \"tenantId\": \"tenant-123\", \"timestamp\": 2026-02-02T14:56:32.833Z, \"userEmail\": \"job@system.com\", \"userId\": \"job-runner\", \"userRole\": \"SYSTEM_JOB\"}\u001b[39m\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m 187 |\u001b[39m       \u001b[90m// Cleanup restores previous context (or clears if none)\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 188 |\u001b[39m       cleanup()\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m 189 |\u001b[39m       expect(tenantContext\u001b[33m.\u001b[39mgetStore())\u001b[33m.\u001b[39mtoBe(previous)\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m     |\u001b[39m                                        \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 190 |\u001b[39m     })\u001b[33m;\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 191 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 192 |\u001b[39m     it(\u001b[32m'should restore previous context after cleanup'\u001b[39m\u001b[33m,\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36mcommon/context/tenant-context.spec.ts\u001b[39m\u001b[0m\u001b[2m:189:40)\u001b[22m\u001b[2m\u001b[22m\n","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\common\\context\\tenant-context.spec.ts","startTime":1770044189368,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["AppController","root"],"duration":7,"failing":false,"failureDetails":[{"type":"AppController","context":{"index":1,"dependencies":[null,null]},"metadata":{"id":"ee9560465818de173bf01"},"moduleRef":{"id":"3e03691116dee95604658"}}],"failureMessages":["Error: Nest can't resolve dependencies of the AppController (AppService, ?). Please make sure that the argument ConfigService at index [1] is available in the RootTestModule context.\n\nPotential solutions:\n- Is RootTestModule a valid NestJS module?\n- If ConfigService is a provider, is it part of the current RootTestModule?\n- If ConfigService is exported from a separate @Module, is that module imported within RootTestModule?\n  @Module({\n    imports: [ /* the Module containing ConfigService */ ]\n  })\n\nFor more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors\n    at TestingInjector.lookupComponentInParentModules (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\injector.js:290:19)\n    at TestingInjector.resolveComponentWrapper (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\testing\\testing-injector.js:19:45)\n    at resolveParam (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\injector.js:140:38)\n    at async Promise.all (index 1)\n    at TestingInjector.resolveConstructorParams (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\injector.js:169:27)\n    at TestingInjector.loadInstance (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\injector.js:75:13)\n    at TestingInjector.loadController (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\injector.js:94:9)\n    at C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\instance-loader.js:68:13\n    at async Promise.all (index 0)\n    at TestingInstanceLoader.createInstancesOfControllers (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\instance-loader.js:67:9)\n    at C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\instance-loader.js:42:13\n    at async Promise.all (index 1)\n    at TestingInstanceLoader.createInstances (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\instance-loader.js:39:9)\n    at TestingInstanceLoader.createInstancesOfDependencies (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\core\\injector\\instance-loader.js:22:13)\n    at TestingInstanceLoader.createInstancesOfDependencies (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\testing\\testing-instance-loader.js:9:9)\n    at TestingModuleBuilder.createInstancesOfDependencies (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\testing\\testing-module.builder.js:118:9)\n    at TestingModuleBuilder.compile (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\node_modules\\@nestjs\\testing\\testing-module.builder.js:74:9)\n    at Object.<anonymous> (C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\app.controller.spec.ts:9:32)"],"fullName":"AppController root should return \"Hello World!\"","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"startAt":1770044193787,"status":"failed","title":"should return \"Hello World!\""}],"endTime":1770044193798,"message":"\u001b[1m\u001b[31m  \u001b[1m● \u001b[22m\u001b[1mAppController › root › should return \"Hello World!\"\u001b[39m\u001b[22m\n\n    Nest can't resolve dependencies of the AppController (AppService, ?). Please make sure that the argument ConfigService at index [1] is available in the RootTestModule context.\n\n    Potential solutions:\n    - Is RootTestModule a valid NestJS module?\n    - If ConfigService is a provider, is it part of the current RootTestModule?\n    - If ConfigService is exported from a separate @Module, is that module imported within RootTestModule?\n      @Module({\n        imports: [ /* the Module containing ConfigService */ ]\n      })\n\n    For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors\n\u001b[2m\u001b[22m\n\u001b[2m    \u001b[0m \u001b[90m  7 |\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m  8 |\u001b[39m   beforeEach(\u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[22m\n\u001b[2m    \u001b[31m\u001b[1m>\u001b[22m\u001b[2m\u001b[39m\u001b[90m  9 |\u001b[39m     \u001b[36mconst\u001b[39m app\u001b[33m:\u001b[39m \u001b[33mTestingModule\u001b[39m \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mTest\u001b[39m\u001b[33m.\u001b[39mcreateTestingModule({\u001b[22m\n\u001b[2m     \u001b[90m    |\u001b[39m                                \u001b[31m\u001b[1m^\u001b[22m\u001b[2m\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 10 |\u001b[39m       controllers\u001b[33m:\u001b[39m [\u001b[33mAppController\u001b[39m]\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 11 |\u001b[39m       providers\u001b[33m:\u001b[39m [\u001b[33mAppService\u001b[39m]\u001b[33m,\u001b[39m\u001b[22m\n\u001b[2m     \u001b[90m 12 |\u001b[39m     })\u001b[33m.\u001b[39mcompile()\u001b[33m;\u001b[39m\u001b[0m\u001b[22m\n\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingInjector.lookupComponentInParentModules (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/injector.js\u001b[2m:290:19)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingInjector.resolveComponentWrapper (\u001b[22m\u001b[2m../node_modules/@nestjs/testing/testing-injector.js\u001b[2m:19:45)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat resolveParam (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/injector.js\u001b[2m:140:38)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m          at async Promise.all (index 1)\u001b[22m\n\u001b[2m      \u001b[2mat TestingInjector.resolveConstructorParams (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/injector.js\u001b[2m:169:27)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingInjector.loadInstance (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/injector.js\u001b[2m:75:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingInjector.loadController (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/injector.js\u001b[2m:94:9)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/instance-loader.js\u001b[2m:68:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m          at async Promise.all (index 0)\u001b[22m\n\u001b[2m      \u001b[2mat TestingInstanceLoader.createInstancesOfControllers (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/instance-loader.js\u001b[2m:67:9)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat \u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/instance-loader.js\u001b[2m:42:13\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m          at async Promise.all (index 1)\u001b[22m\n\u001b[2m      \u001b[2mat TestingInstanceLoader.createInstances (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/instance-loader.js\u001b[2m:39:9)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingInstanceLoader.createInstancesOfDependencies (\u001b[22m\u001b[2m../node_modules/@nestjs/core/injector/instance-loader.js\u001b[2m:22:13)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingInstanceLoader.createInstancesOfDependencies (\u001b[22m\u001b[2m../node_modules/@nestjs/testing/testing-instance-loader.js\u001b[2m:9:9)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingModuleBuilder.createInstancesOfDependencies (\u001b[22m\u001b[2m../node_modules/@nestjs/testing/testing-module.builder.js\u001b[2m:118:9)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat TestingModuleBuilder.compile (\u001b[22m\u001b[2m../node_modules/@nestjs/testing/testing-module.builder.js\u001b[2m:74:9)\u001b[22m\u001b[2m\u001b[22m\n\u001b[2m      \u001b[2mat Object.<anonymous> (\u001b[22m\u001b[2m\u001b[0m\u001b[36mapp.controller.spec.ts\u001b[39m\u001b[0m\u001b[2m:9:32)\u001b[22m\u001b[2m\u001b[22m\n","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\app.controller.spec.ts","startTime":1770044192934,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["TenantQueryRunnerService"],"duration":4,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService should be defined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194510,"status":"passed","title":"should be defined"},{"ancestorTitles":["TenantQueryRunnerService","validateSchemaName"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService validateSchemaName should validate correct schema names","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194515,"status":"passed","title":"should validate correct schema names"},{"ancestorTitles":["TenantQueryRunnerService","validateSchemaName"],"duration":13,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService validateSchemaName should reject invalid schema names","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"startAt":1770044194518,"status":"passed","title":"should reject invalid schema names"},{"ancestorTitles":["TenantQueryRunnerService","validateSchemaName"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService validateSchemaName should reject SQL injection attempts","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044194532,"status":"passed","title":"should reject SQL injection attempts"},{"ancestorTitles":["TenantQueryRunnerService","Core functionality"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Core functionality should have execute method","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194535,"status":"passed","title":"should have execute method"},{"ancestorTitles":["TenantQueryRunnerService","Core functionality"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Core functionality should have transaction method","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194539,"status":"passed","title":"should have transaction method"},{"ancestorTitles":["TenantQueryRunnerService","Core functionality"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Core functionality should have getRunner method","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194542,"status":"passed","title":"should have getRunner method"},{"ancestorTitles":["TenantQueryRunnerService","Error handling patterns"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Error handling patterns should throw error when tenant context is missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194543,"status":"passed","title":"should throw error when tenant context is missing"},{"ancestorTitles":["TenantQueryRunnerService","Error handling patterns"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Error handling patterns should validate schema format before use","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"startAt":1770044194547,"status":"passed","title":"should validate schema format before use"},{"ancestorTitles":["TenantQueryRunnerService","Unit Test TenantQueryRunnerService"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Unit Test TenantQueryRunnerService should mock tenant context and ensure queries run only in correct schema","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044194550,"status":"passed","title":"should mock tenant context and ensure queries run only in correct schema"},{"ancestorTitles":["TenantQueryRunnerService","Unit Test TenantQueryRunnerService"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Unit Test TenantQueryRunnerService should repeat with different tenant and ensure results are different","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044194553,"status":"passed","title":"should repeat with different tenant and ensure results are different"},{"ancestorTitles":["TenantQueryRunnerService","Unit Test TenantQueryRunnerService"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Unit Test TenantQueryRunnerService should try removing context and expect error: Tenant context required","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194557,"status":"passed","title":"should try removing context and expect error: Tenant context required"},{"ancestorTitles":["TenantQueryRunnerService","Role Enforcement Test"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Role Enforcement Test should verify that DB roles prevent access","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194559,"status":"passed","title":"should verify that DB roles prevent access"},{"ancestorTitles":["TenantQueryRunnerService","Background Jobs Test"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Background Jobs Test should ensure jobs don't leak data between tenants","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044194561,"status":"passed","title":"should ensure jobs don't leak data between tenants"},{"ancestorTitles":["TenantQueryRunnerService","Negative Tests"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Negative Tests should call TenantQueryRunnerService without context and must fail","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044194563,"status":"passed","title":"should call TenantQueryRunnerService without context and must fail"},{"ancestorTitles":["TenantQueryRunnerService","Negative Tests"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Negative Tests should try changing schemaName manually and must fail validation","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"startAt":1770044194565,"status":"passed","title":"should try changing schemaName manually and must fail validation"},{"ancestorTitles":["TenantQueryRunnerService","Negative Tests"],"duration":6,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Negative Tests should run with non-existent schema and fail","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194567,"status":"passed","title":"should run with non-existent schema and fail"},{"ancestorTitles":["TenantQueryRunnerService","Security: Mandatory tenant context enforcement"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Mandatory tenant context enforcement should FAIL FAST when tenant context is completely missing","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044194573,"status":"passed","title":"should FAIL FAST when tenant context is completely missing"},{"ancestorTitles":["TenantQueryRunnerService","Security: Mandatory tenant context enforcement"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Mandatory tenant context enforcement should FAIL FAST when tenantId is null","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194576,"status":"passed","title":"should FAIL FAST when tenantId is null"},{"ancestorTitles":["TenantQueryRunnerService","Security: Mandatory tenant context enforcement"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Mandatory tenant context enforcement should FAIL FAST when tenantId is undefined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194578,"status":"passed","title":"should FAIL FAST when tenantId is undefined"},{"ancestorTitles":["TenantQueryRunnerService","Security: Mandatory tenant context enforcement"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Mandatory tenant context enforcement should FAIL FAST when tenantId is empty string","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194580,"status":"passed","title":"should FAIL FAST when tenantId is empty string"},{"ancestorTitles":["TenantQueryRunnerService","Security: Mandatory tenant context enforcement"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Mandatory tenant context enforcement should NOT allow SYSTEM identity (00000000-0000-0000-0000-000000000000) to bypass context check","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044194582,"status":"passed","title":"should NOT allow SYSTEM identity (00000000-0000-0000-0000-000000000000) to bypass context check"},{"ancestorTitles":["TenantQueryRunnerService","Security: execute() mandatory context"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: execute() mandatory context should FAIL FAST when calling execute() without context","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044194584,"status":"passed","title":"should FAIL FAST when calling execute() without context"},{"ancestorTitles":["TenantQueryRunnerService","Security: execute() mandatory context"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: execute() mandatory context should execute parameterized query with context","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044194587,"status":"passed","title":"should execute parameterized query with context"},{"ancestorTitles":["TenantQueryRunnerService","Security: execute() mandatory context"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: execute() mandatory context should release runner even if context missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194590,"status":"passed","title":"should release runner even if context missing"},{"ancestorTitles":["TenantQueryRunnerService","Security: transaction() mandatory context"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: transaction() mandatory context should FAIL FAST when calling transaction() without context","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044194592,"status":"passed","title":"should FAIL FAST when calling transaction() without context"},{"ancestorTitles":["TenantQueryRunnerService","Security: transaction() mandatory context"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: transaction() mandatory context should support parameterized queries in transaction work function","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"startAt":1770044194594,"status":"passed","title":"should support parameterized queries in transaction work function"},{"ancestorTitles":["TenantQueryRunnerService","Security: No SQL injection vectors"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: No SQL injection vectors should use parameterized queries for all user-provided data","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194596,"status":"passed","title":"should use parameterized queries for all user-provided data"},{"ancestorTitles":["TenantQueryRunnerService","Security: No SQL injection vectors"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: No SQL injection vectors should NOT use string concatenation for tenant context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194598,"status":"passed","title":"should NOT use string concatenation for tenant context"},{"ancestorTitles":["TenantQueryRunnerService","Security: Schema enumeration protection"],"duration":4,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Schema enumeration protection should NOT reveal schema name when schema does not exist","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194599,"status":"passed","title":"should NOT reveal schema name when schema does not exist"},{"ancestorTitles":["TenantQueryRunnerService","Security: Schema enumeration protection"],"duration":5,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Schema enumeration protection should log detailed error internally but return generic message","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044194603,"status":"passed","title":"should log detailed error internally but return generic message"},{"ancestorTitles":["TenantQueryRunnerService","Security: Schema enumeration protection"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantQueryRunnerService Security: Schema enumeration protection should NOT allow schema enumeration attack via different tenant IDs","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044194609,"status":"passed","title":"should NOT allow schema enumeration attack via different tenant IDs"}],"endTime":1770044194614,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\database\\tenant-query-runner.service.spec.ts","startTime":1770044193814,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["AuthService","validateUser"],"duration":14,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"AuthService validateUser should return user object (minus password) if credentials and tenant match","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044197182,"status":"passed","title":"should return user object (minus password) if credentials and tenant match"},{"ancestorTitles":["AuthService","validateUser"],"duration":7,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"AuthService validateUser should return null if password check fails","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044197197,"status":"passed","title":"should return null if password check fails"},{"ancestorTitles":["AuthService","generateTenantSession (The Upgrade Logic)"],"duration":6,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"AuthService generateTenantSession (The Upgrade Logic) should issue an upgraded token if user has a tenant_id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044197217,"status":"passed","title":"should issue an upgraded token if user has a tenant_id"},{"ancestorTitles":["AuthService","generateTenantSession (The Upgrade Logic)"],"duration":43,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"AuthService generateTenantSession (The Upgrade Logic) should throw if trying to upgrade a user who still has no tenant_id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044197247,"status":"passed","title":"should throw if trying to upgrade a user who still has no tenant_id"}],"endTime":1770044197310,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\auth\\auth.service.spec.ts","startTime":1770044194649,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["InvoicesService"],"duration":10,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"InvoicesService should be defined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044198899,"status":"passed","title":"should be defined"},{"ancestorTitles":["InvoicesService"],"duration":14,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"InvoicesService should find all invoices","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044198913,"status":"passed","title":"should find all invoices"},{"ancestorTitles":["InvoicesService"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"InvoicesService should create invoice with transaction","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044198928,"status":"passed","title":"should create invoice with transaction"}],"endTime":1770044198935,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\finance\\invoices\\invoices.service.spec.ts","startTime":1770044197611,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["UsersService (Multi-tenant)","create"],"duration":265,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"UsersService (Multi-tenant) create should create a user scoped to the current tenant","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044199853,"status":"passed","title":"should create a user scoped to the current tenant"},{"ancestorTitles":["UsersService (Multi-tenant)","create"],"duration":149,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"UsersService (Multi-tenant) create should throw ConflictException if email exists in tenant","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044200155,"status":"passed","title":"should throw ConflictException if email exists in tenant"}],"endTime":1770044200320,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\users\\tests\\users.service.spec.ts","startTime":1770044198992,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["TenantContextMiddleware"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContextMiddleware should allow public auth routes without a tenant context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044201340,"status":"passed","title":"should allow public auth routes without a tenant context"},{"ancestorTitles":["TenantContextMiddleware"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContextMiddleware should throw UnauthorizedException if a private route is accessed without tenant context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044201391,"status":"passed","title":"should throw UnauthorizedException if a private route is accessed without tenant context"},{"ancestorTitles":["TenantContextMiddleware"],"duration":15,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContextMiddleware should use schemaName from JWT (Optimization) to avoid DB lookup","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044201439,"status":"passed","title":"should use schemaName from JWT (Optimization) to avoid DB lookup"},{"ancestorTitles":["TenantContextMiddleware"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContextMiddleware should fallback to DB lookup if schemaName is missing from JWT","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044201458,"status":"passed","title":"should fallback to DB lookup if schemaName is missing from JWT"},{"ancestorTitles":["TenantContextMiddleware"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantContextMiddleware should throw UnauthorizedException if tenant is found but INACTIVE","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044201474,"status":"passed","title":"should throw UnauthorizedException if tenant is found but INACTIVE"}],"endTime":1770044201479,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\common\\middleware\\tenant-context.middleware.spec.ts","startTime":1770044200344,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["DatabaseService"],"duration":9,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService should be defined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044202744,"status":"passed","title":"should be defined"},{"ancestorTitles":["DatabaseService","checkConnection"],"duration":17,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService checkConnection should return true when connection is healthy","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044202754,"status":"passed","title":"should return true when connection is healthy"},{"ancestorTitles":["DatabaseService","checkConnection"],"duration":16,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService checkConnection should return false when connection fails","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044202772,"status":"passed","title":"should return false when connection fails"},{"ancestorTitles":["DatabaseService","getMasterDataSource"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService getMasterDataSource should return the master data source","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044202789,"status":"passed","title":"should return the master data source"},{"ancestorTitles":["DatabaseService","executeQuery"],"duration":5,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService executeQuery should execute a query and return results","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044202792,"status":"passed","title":"should execute a query and return results"},{"ancestorTitles":["DatabaseService","executeQuery"],"duration":4,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService executeQuery should execute a query with parameters","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044202799,"status":"passed","title":"should execute a query with parameters"},{"ancestorTitles":["DatabaseService","schemaExists"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService schemaExists should return true if schema exists","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044202804,"status":"passed","title":"should return true if schema exists"},{"ancestorTitles":["DatabaseService","schemaExists"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService schemaExists should return false if schema does not exist","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044202808,"status":"passed","title":"should return false if schema does not exist"},{"ancestorTitles":["DatabaseService","getPoolStats"],"duration":4,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService getPoolStats should return pool configuration","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044202811,"status":"passed","title":"should return pool configuration"},{"ancestorTitles":["DatabaseService","getDatabaseStats"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService getDatabaseStats should return database statistics","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044202818,"status":"passed","title":"should return database statistics"},{"ancestorTitles":["DatabaseService","getDatabaseStats"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"DatabaseService getDatabaseStats should return zero counts when not connected","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044202822,"status":"passed","title":"should return zero counts when not connected"}],"endTime":1770044202827,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\database\\database.service.spec.ts","startTime":1770044201655,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["RoleEnforcementGuard"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard should be defined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212343,"status":"passed","title":"should be defined"},{"ancestorTitles":["RoleEnforcementGuard","canActivate()"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard canActivate() should allow access when no role requirement is specified","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212347,"status":"passed","title":"should allow access when no role requirement is specified"},{"ancestorTitles":["RoleEnforcementGuard","canActivate()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard canActivate() should allow access when user role matches required role","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212351,"status":"passed","title":"should allow access when user role matches required role"},{"ancestorTitles":["RoleEnforcementGuard","canActivate()"],"duration":10,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard canActivate() should deny access when user role does NOT match required role","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212353,"status":"passed","title":"should deny access when user role does NOT match required role"},{"ancestorTitles":["RoleEnforcementGuard","canActivate()"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard canActivate() should deny access when context is missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212364,"status":"passed","title":"should deny access when context is missing"},{"ancestorTitles":["RoleEnforcementGuard","Privilege minimization: System roles"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard Privilege minimization: System roles should enforce SYSTEM_MIGRATION role separation","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044212366,"status":"passed","title":"should enforce SYSTEM_MIGRATION role separation"},{"ancestorTitles":["RoleEnforcementGuard","Privilege minimization: System roles"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard Privilege minimization: System roles should enforce SYSTEM_JOB role separation","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044212369,"status":"passed","title":"should enforce SYSTEM_JOB role separation"},{"ancestorTitles":["RoleEnforcementGuard","Privilege minimization: System roles"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard Privilege minimization: System roles should enforce SYSTEM_READONLY role separation","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044212371,"status":"passed","title":"should enforce SYSTEM_READONLY role separation"},{"ancestorTitles":["RoleEnforcementGuard","Error handling"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RoleEnforcementGuard Error handling should provide clear error message with required role","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212375,"status":"passed","title":"should provide clear error message with required role"}],"endTime":1770044212378,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\common\\guards\\role-enforcement.guard.spec.ts","startTime":1770044211973,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["TenantProvisioningService","createOrganization"],"duration":5,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantProvisioningService createOrganization should successfully provision a tenant when all steps pass","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"startAt":1770044212667,"status":"passed","title":"should successfully provision a tenant when all steps pass"},{"ancestorTitles":["TenantProvisioningService","createOrganization"],"duration":6,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantProvisioningService createOrganization should throw NotFoundException if the plan does not exist","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044212674,"status":"passed","title":"should throw NotFoundException if the plan does not exist"},{"ancestorTitles":["TenantProvisioningService","createOrganization"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantProvisioningService createOrganization should throw InternalServerErrorException and rollback if schema creation fails","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212681,"status":"passed","title":"should throw InternalServerErrorException and rollback if schema creation fails"},{"ancestorTitles":["TenantProvisioningService","findAll"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"TenantProvisioningService findAll should return a list of tenants with joins","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044212684,"status":"passed","title":"should return a list of tenants with joins"}],"endTime":1770044212687,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\tenants\\tenants.service.spec.ts","startTime":1770044212410,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["RLSContextService","setRLSContext()"],"duration":4,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService setRLSContext() should set app.tenant_id session variable for regular tenant users","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212903,"status":"passed","title":"should set app.tenant_id session variable for regular tenant users"},{"ancestorTitles":["RLSContextService","setRLSContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService setRLSContext() should set app.tenant_id to SYSTEM_MIGRATION for migration role","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212908,"status":"passed","title":"should set app.tenant_id to SYSTEM_MIGRATION for migration role"},{"ancestorTitles":["RLSContextService","setRLSContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService setRLSContext() should set app.tenant_id to SYSTEM_JOB for job role","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212911,"status":"passed","title":"should set app.tenant_id to SYSTEM_JOB for job role"},{"ancestorTitles":["RLSContextService","setRLSContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService setRLSContext() should set app.tenant_id to SYSTEM_READONLY for readonly role","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212913,"status":"passed","title":"should set app.tenant_id to SYSTEM_READONLY for readonly role"},{"ancestorTitles":["RLSContextService","setRLSContext()"],"duration":10,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService setRLSContext() should throw error when tenant context is missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212914,"status":"passed","title":"should throw error when tenant context is missing"},{"ancestorTitles":["RLSContextService","setRLSContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService setRLSContext() should throw error when tenantId is null","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212925,"status":"passed","title":"should throw error when tenantId is null"},{"ancestorTitles":["RLSContextService","clearRLSContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService clearRLSContext() should reset app.tenant_id session variable","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212927,"status":"passed","title":"should reset app.tenant_id session variable"},{"ancestorTitles":["RLSContextService","clearRLSContext()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService clearRLSContext() should not throw on error (connection being released)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212928,"status":"passed","title":"should not throw on error (connection being released)"},{"ancestorTitles":["RLSContextService","verifyRLSEnforcement()"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService verifyRLSEnforcement() should verify that RLS is enforcing isolation","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044212930,"status":"passed","title":"should verify that RLS is enforcing isolation"},{"ancestorTitles":["RLSContextService","verifyRLSEnforcement()"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService verifyRLSEnforcement() should throw error if RLS is NOT enforcing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212932,"status":"passed","title":"should throw error if RLS is NOT enforcing"},{"ancestorTitles":["RLSContextService","verifyRLSEnforcement()"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService verifyRLSEnforcement() should clean up temporary runner even on error","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212935,"status":"passed","title":"should clean up temporary runner even on error"},{"ancestorTitles":["RLSContextService","Security: RLS Context Isolation"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService Security: RLS Context Isolation should isolate context between concurrent requests","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044212939,"status":"passed","title":"should isolate context between concurrent requests"},{"ancestorTitles":["RLSContextService","Security: RLS Context Isolation"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"RLSContextService Security: RLS Context Isolation should NOT allow one system role to bypass another","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044212942,"status":"passed","title":"should NOT allow one system role to bypass another"}],"endTime":1770044212946,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\database\\rls-context.service.spec.ts","startTime":1770044212710,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["ConfigService"],"duration":5,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService should be defined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213194,"status":"passed","title":"should be defined"},{"ancestorTitles":["ConfigService","Environment"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Environment should return node environment","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213200,"status":"passed","title":"should return node environment"},{"ancestorTitles":["ConfigService","Environment"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Environment should return port number","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213203,"status":"passed","title":"should return port number"},{"ancestorTitles":["ConfigService","Environment"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Environment should detect development environment","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213207,"status":"passed","title":"should detect development environment"},{"ancestorTitles":["ConfigService","Environment"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Environment should detect production environment","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213209,"status":"passed","title":"should detect production environment"},{"ancestorTitles":["ConfigService","Database"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Database should return database host","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213211,"status":"passed","title":"should return database host"},{"ancestorTitles":["ConfigService","Database"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Database should return database port","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213213,"status":"passed","title":"should return database port"},{"ancestorTitles":["ConfigService","Database"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Database should return database name","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213216,"status":"passed","title":"should return database name"},{"ancestorTitles":["ConfigService","Database"],"duration":4,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Database should return pool size as number","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"startAt":1770044213220,"status":"passed","title":"should return pool size as number"},{"ancestorTitles":["ConfigService","JWT"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService JWT should return JWT secret","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213226,"status":"passed","title":"should return JWT secret"},{"ancestorTitles":["ConfigService","JWT"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService JWT should return JWT expiration","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213229,"status":"passed","title":"should return JWT expiration"},{"ancestorTitles":["ConfigService","OpenAI"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService OpenAI should return OpenAI model","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213232,"status":"passed","title":"should return OpenAI model"},{"ancestorTitles":["ConfigService","OpenAI"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService OpenAI should return max tokens as number","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213236,"status":"passed","title":"should return max tokens as number"},{"ancestorTitles":["ConfigService","Features"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Features should return chat enabled flag","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213240,"status":"passed","title":"should return chat enabled flag"},{"ancestorTitles":["ConfigService","Features"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Features should return AI enabled flag","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213243,"status":"passed","title":"should return AI enabled flag"},{"ancestorTitles":["ConfigService","Features"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Features should return file upload enabled flag","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213247,"status":"passed","title":"should return file upload enabled flag"},{"ancestorTitles":["ConfigService","Generic access"],"duration":2,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Generic access should get value by path","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213251,"status":"passed","title":"should get value by path"},{"ancestorTitles":["ConfigService","Generic access"],"duration":4,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Generic access should get nested value by path","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213254,"status":"passed","title":"should get nested value by path"},{"ancestorTitles":["ConfigService","Validation"],"duration":9,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ConfigService Validation should validate config without errors in development","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213259,"status":"passed","title":"should validate config without errors in development"}],"endTime":1770044213269,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\config\\config.service.spec.ts","startTime":1770044212970,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["ActiveTenant Decorator"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should extract tenantId from context when data=\"id\"","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213331,"status":"passed","title":"should extract tenantId from context when data=\"id\""},{"ancestorTitles":["ActiveTenant Decorator"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should extract userId from context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213332,"status":"passed","title":"should extract userId from context"},{"ancestorTitles":["ActiveTenant Decorator"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should extract schemaName from context","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213333,"status":"passed","title":"should extract schemaName from context"},{"ancestorTitles":["ActiveTenant Decorator"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should return full context when data is undefined","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"startAt":1770044213334,"status":"passed","title":"should return full context when data is undefined"},{"ancestorTitles":["ActiveTenant Decorator"],"duration":7,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should throw when context is missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213335,"status":"passed","title":"should throw when context is missing"},{"ancestorTitles":["ActiveTenant Decorator"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should ignore tenantId from request params","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213342,"status":"passed","title":"should ignore tenantId from request params"},{"ancestorTitles":["ActiveTenant Decorator"],"duration":0,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should ignore tenantId from request body","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213344,"status":"passed","title":"should ignore tenantId from request body"},{"ancestorTitles":["ActiveTenant Decorator"],"duration":1,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"ActiveTenant Decorator should ignore tenantId from request query","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1770044213344,"status":"passed","title":"should ignore tenantId from request query"}],"endTime":1770044213346,"message":"","name":"C:\\Users\\gashn\\Desktop\\erp\\erp-middleware\\src\\common\\decorators\\active-tenant.decorator.spec.ts","startTime":1770044213294,"status":"passed","summary":""}],"wasInterrupted":false}
